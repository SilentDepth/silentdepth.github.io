<!doctype html>
<link rel="stylesheet" href="reveal.js/css/reveal.css">
<link rel="stylesheet" href="reveal.js/css/theme/league.css">
<link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">
<style>
  .title-em {
    color: #EAD53F;
  }
  .no-include {
    opacity: .2;
  }
  .double-list {
    width: 100%;
    text-align: center;
  }
  .double-list ul {
    display: inline-block;
    max-width: calc(50% - 60px);
    vertical-align: top;
  }
  .double-list ul:first-child {
    margin-right: 40px;
  }
  .chn {
    font-size: .8em !important;
    position: relative;
    top: -.1em;
  }
</style>

<div class="reveal">
  <div class="slides">
    <!-- ES6 -->

    <section>
      <section>
        <h1>ECMAScript <span class="title-em">2015</span> (<span class="title-em">ES6</span>)</h1>
        <h3>New Feature Tutorial</h3>
      </section>
      <section data-transition="slide-in fade-out">
        <h3>ES6 Feature List</h3>
        <div class="double-list">
          <ul>
            <li>Arrows</li>
            <li>Classes</li>
            <li>Enhanced object literals</li>
            <li>Template strings</li>
            <li>Destructuring</li>
            <li>Default + rest + spread</li>
            <li>Let + Const</li>
            <li>Iterators + For...of</li>
            <li>Generators</li>
            <li>Unicode</li>
          </ul><ul>
            <li>Modules &amp; module loaders</li>
            <li>Map + Set + WeakMap + WeakSet</li>
            <li>Proxies</li>
            <li>Symbols</li>
            <li>Subclassable built-ins</li>
            <li>Promises</li>
            <li>Math + Number + String + Array + Object APIs</li>
            <li>Binary and octal literals</li>
            <li>Reflect API</li>
            <li>Tail calls</li>
          </ul>
        </div>
      </section>
      <section data-transition="fade-in slide-out">
        <h3>ES6 Feature List</h3>
        <div class="double-list">
          <ul>
            <li>Arrows</li>
            <li>Classes</li>
            <li>Enhanced object literals</li>
            <li>Template strings</li>
            <li>Destructuring</li>
            <li>Default + rest + spread</li>
            <li>Let + Const</li>
            <li>Iterators + For...of</li>
            <li>Generators</li>
            <li class="no-include">Unicode</li>
          </ul><ul>
            <li class="no-include">Modules &amp; module loaders</li>
            <li>Map + Set + WeakMap + WeakSet</li>
            <li>Proxies</li>
            <li>Symbols</li>
            <li class="no-include">Subclassable built-ins</li>
            <li>Promise</li>
            <li class="no-include">Math + Number + String + Array + Object APIs</li>
            <li class="no-include">Binary and octal literals</li>
            <li>Reflect API</li>
            <li class="no-include">Tail calls</li>
          </ul>
        </div>
      </section>
    </section>
    <section>
      <h2>Destructuring <span class="chn">解构</span></h2>
      <pre><code class="javascript" data-trim>
        // list matching
        var [a, , b] = [1, 2, 3];

        // object matching
        var {op: a, lhs: {op: b}, rhs: c} = getASTNode()

        // object matching shorthand
        // binds `op`, `lhs` and `rhs` in scope
        var {op, lhs, rhs} = getASTNode()

        // Can be used in parameter position
        function g({name: x}) {
          console.log(x);
        }
        g({name: 5})

        // Fail-soft destructuring
        var [a] = []; // a === undefined

        // Fail-soft destructuring with defaults
        var [a = 1] = []; // a === 1
      </code></pre>
    </section>
    <section>
      <h2>Enhanced Object Literals <span class="chn">对象简写</span></h2>
      <pre><code class="javascript" data-trim>
        var obj = {
          // __proto__
          __proto__: theProtoObj,
          // Shorthand for 'handler: handler'
          handler,
          // Methods
          toString() {
           // Super calls
           return "d " + super.toString();
          },
          // Computed (dynamic) property names
          [ 'prop_' + (() => 42)() ]: 42
        };
      </code></pre>
    </section>
    <section>
      <h2>Arrow Function <span class="chn">箭头函数</span></h2>
      <pre><code class="javascript" data-trim>
        // Expression bodies
        var odds = evens.map(v => v + 1);
        var nums = evens.map((v, i) => v + i);
        var pairs = evens.map(v => ({even: v, odd: v + 1}));

        // Statement bodies
        nums.forEach(v => {
          if (v % 5 === 0)
            fives.push(v);
        });

        // Lexical this
        var bob = {
          _name: "Bob",
          _friends: [],
          printFriends() {
            this._friends.forEach(f =>
              console.log(this._name + " knows " + f));
          }
        }
      </code></pre>
    </section>
    <section>
      <h2>Default + Rest + Spread</h2>
      <pre><code class="javascript" data-trim>
        function f(x, y=12) {
          // y is 12 if not passed (or passed as undefined)
          return x + y;
        }
        f(3) == 15

        function f(x, ...y) {
          // y is an Array
          return x * y.length;
        }
        f(3, "hello", true) == 6

        function f(x, y, z) {
          return x + y + z;
        }
        // Pass each elem of array as argument
        f(...[1,2,3]) == 6
      </code></pre>
    </section>
    <section>
      <h2>Class</h2>
      <pre><code class="javascript" data-trim>
        class SkinnedMesh extends THREE.Mesh {
          constructor(geometry, materials) {
            super(geometry, materials);

            this.idMatrix = SkinnedMesh.defaultMatrix();
            this.bones = [];
            this.boneMatrices = [];
            //...
          }
          update(camera) {
            //...
            super.update();
          }
          get boneCount() {
            return this.bones.length;
          }
          set matrixType(matrixType) {
            this.idMatrix = SkinnedMesh[matrixType]();
          }
          static defaultMatrix() {
            return new THREE.Matrix4();
          }
        }
      </code></pre>
    </section>
    <section>
      <h2>Template Strings <span class="chn">模板字符串</span></h2>
      <pre><code class="javascript" data-trim>
        // Basic literal string creation
        `In JavaScript '\n' is a line-feed.`
        
        // Multiline strings
        `In JavaScript this is
         not legal.`
        
        // String interpolation
        var name = "Bob", time = "today";
        `Hello ${name}, how are you ${time}?`
        
        // Construct an HTTP request prefix is used to interpret the replacements and construction
        POST`http://foo.org/bar?a=${a}&b=${b}
             Content-Type: application/json
             X-Credentials: ${credentials}
             { "foo": ${foo},
               "bar": ${bar}}`(myOnReadyStateChangeHandler);        
      </code></pre>
    </section>
    <section>
      <h2>Let + Const</h2>
      <pre><code class="javascript" data-trim>
        function f() {
          {
            let x;
            {
              // okay, block scoped name
              const x = "sneaky";
              // error, const
              x = "foo";
            }
            // error, already declared in block
            let x = "inner";
          }
        }
      </code></pre>
    </section>
    <section>
      <h2>Symbols</h2>
      <h6>(Babel: Partial Support)</h6>
      <pre><code class="javascript" data-trim>
        var MyClass = (function() {

          // module scoped symbol
          var key = Symbol("key");

          function MyClass(privateData) {
            this[key] = privateData;
          }

          MyClass.prototype = {
            doStuff: function() {
              ... this[key] ...
            }
          };

          return MyClass;
        })();

        var c = new MyClass("hello")
        c["key"] === undefined
      </code></pre>
    </section>
    <section>
      <h2>Map + Set + WeakMap + WeakSet</h2>
      <pre><code class="javascript" data-trim>
        // Sets
        var s = new Set();
        s.add("hello").add("goodbye").add("hello");
        s.size === 2;
        s.has("hello") === true;

        // Maps
        var m = new Map();
        m.set("hello", 42);
        m.set(s, 34);
        m.get(s) == 34;

        // Weak Maps
        var wm = new WeakMap();
        wm.set(s, { extra: 42 });
        wm.size === undefined

        // Weak Sets
        var ws = new WeakSet();
        ws.add({ data: 42 });
        // Because the added object has no other references, it will not be held in the set
      </code></pre>
    </section>
    <section>
      <h2>Promise</h2>
      <pre><code class="javascript" data-trim>
        function timeout(duration = 0) {
            return new Promise((resolve, reject) => {
                setTimeout(resolve, duration);
            })
        }

        var p = timeout(1000).then(() => {
            return timeout(2000);
        }).then(() => {
            throw new Error("hmm");
        }).catch(err => {
            return Promise.all([timeout(100), timeout(200)]);
        })
      </code></pre>
    </section>
    <section>
      <h2>Iterators + For...Of</h2>
      <pre><code class="javascript" data-trim>
        let fibonacci = {
          [Symbol.iterator]() {
            let pre = 0, cur = 1;
            return {
              next() {
                [pre, cur] = [cur, pre + cur];
                return { done: false, value: cur }
              }
            }
          }
        }

        for (var n of fibonacci) {
          // truncate the sequence at 1000
          if (n > 1000)
            break;
          console.log(n);
        }
      </code></pre>
    </section>
    <section>
      <h2>Generators</h2>
      <pre><code class="javascript" data-trim>
        var fibonacci = {
          [Symbol.iterator]: function*() {
            var pre = 0, cur = 1;
            for (;;) {
              var temp = pre;
              pre = cur;
              cur += temp;
              yield cur;
            }
          }
        }

        for (var n of fibonacci) {
          // truncate the sequence at 1000
          if (n > 1000)
            break;
          console.log(n);
        }
      </code></pre>
    </section>
    <section>
      <h2>Proxies</h2>
      <h6>(Babel: No Support)</h6>
      <pre><code class="javascript" data-trim>
        // Proxying a normal object
        var target = {};
        var handler = {
          get: function (receiver, name) {
            return `Hello, ${name}!`;
          }
        };

        var p = new Proxy(target, handler);
        p.world === 'Hello, world!';

        // Proxying a function object
        var target = function () { return 'I am the target'; };
        var handler = {
          apply: function (receiver, ...args) {
            return 'I am the proxy';
          }
        };

        var p = new Proxy(target, handler);
        p() === 'I am the proxy';
      </code></pre>
    </section>
    <section>
      <h2>Reflect API</h2>
      <pre><code class="javascript" data-trim>
        // No example
      </code></pre>
    </section>

    <!-- ES7 -->

    <section>
      <section>
        <h2>ECMAScript <span class="title-em">2016</span> (<span class="title-em">ES7</span>)</h2>
        <h3>New Feature Tutorial</h3>
      </section>
      <section>
        <h3>ES7 Feature List</h3>
        <ul>
          <li><code>Array.prototype.includes</code></li>
          <li>Exponentiation Operator</li>
        </ul>
      </section>
    </section>
    <section>
      <h2><code>Array.prototype.includes</code></h2>
      <pre><code class="javascript" data-trim>
        ['a', 'b', 'c'].includes('a') // true
        ['a', 'b', 'c'].includes('d') // false

        // Following expressions are mostly equivalent
        arr.includes(x)
        arr.indexOf(x) >= 0

        // But `includes()` finds `NaN`
        [NaN].includes(NaN) // true
        [NaN].indexOf(NaN) // -1
      </code></pre>
    </section>
    <section>
      <h2>Exponentiation Operator</h2>
      <pre><code class="javascript" data-trim>
        // Following expressions are equivalent
        x ** y
        Math.pow(x, y)

        // More examples
        let squared = 3 ** 2; // 9

        let num = 3;
        num **= 2;
        console.log(num); // 9
      </code></pre>
    </section>

    <!-- ES8 -->

    <section>
      <section>
        <h2>ECMAScript <span class="title-em">2017</span> (<span class="title-em">ES8</span>)</h2>
        <h3>New Feature Tutorial</h3>
      </section>
      <section>
        <h3>ES8 Feature List</h3>
        <ul>
          <li>Async Functions (Finally!)</li>
          <li>Shared memory and atomics</li>
          <li>Object.values/Object.entries</li>
          <li>String padding</li>
          <li>Object.getOwnPropertyDescriptors()</li>
          <li>Trailing commas in function parameter lists and calls</li>
        </ul>
      </section>
    </section>
    <section>
      <h2>Async Functions</h2>
      <pre><code class="javascript" data-trim>
        // Promise
        function fetchJson(url) {
          return fetch(url)
            .then(request => request.text())
            .then(text => {
              return JSON.parse(text);
            })
            .catch(error => {
              console.log(`ERROR: ${error.stack}`);
            });
        }
        fetchJson('http://example.com/some_file.json').then(obj => console.log(obj));

        // Async function
        async function fetchJson(url) {
          try {
            let request = await fetch(url);
            let text = await request.text();
            return JSON.parse(text);
          }
          catch (error) {
            console.log(`ERROR: ${error.stack}`);
          }
        }
      </code></pre>
    </section>
    <section>
      <h2>String Padding</h2>
      <pre><code class="javascript" data-trim>
        'x'.padStart(5, 'ab') // 'ababx'
        'x'.padStart(4, 'ab') // 'abax'
        'abcd'.padStart(2, '#') // 'abcd'
        'abc'.padStart(10, '0123456789') // '0123456abc'
        'x'.padStart(3) // '  x'

        'x'.padEnd(5, 'ab') // 'xabab'
        'x'.padEnd(4, 'ab') // 'xaba'
        'abcd'.padEnd(2, '#') // 'abcd'
        'abc'.padEnd(10, '0123456789') // 'abc0123456'
        'x'.padEnd(3) // 'x  '
      </code></pre>
    </section>
    <section>
      <section>
        <h2>Trailing Commas</h2>
        <h6>In Function Parameter Lists And Calls</h6>
        <pre><code class="javascript" data-trim>
          // Trailing comma in array literals are ignored
          [1, 2, 3,]

          // ...as well as in object literals (ES5)
          {a: 1, b: 2, c: 3,}

          // ...and now in function parameter lists and calls (ES8)
          function foo(para1, para2,) {}
          foo(p1, p2,)
        </code></pre>
      </section>
      <section>
        <h3>Why this?</h3>
        <pre><code class="javascript" data-trim>
          // When appending an element in old days...
          [                               [
            'one',                          'one',
            'two'     /* change to */       'two',
          ]                                 'three'
                                          ]

          // ...a diff log like this comes out
          -3 | 'two'  // these 2 lines are actually meaning-less
          +3 | 'two', //
          +4 | 'three'
        </code></pre>
      </section>
    </section>

    <!-- End -->

    <section>
      <h2>Thanks</h2>
      <h6>and</h6>
      <h2>Q&A</h2>
    </section>
  </div>
</div>

<script src="reveal.js/lib/js/head.min.js"></script>
<script src="reveal.js/js/reveal.js"></script>
<script>
  Reveal.initialize({
    width: '100%',
    height: '100%',
//    controls: false,
    dependencies: [
      { src: 'reveal.js/plugin/markdown/marked.js' },
      { src: 'reveal.js/plugin/markdown/markdown.js' },
      { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function () { hljs.initHighlightingOnLoad(); } },
    ],
  });
</script>