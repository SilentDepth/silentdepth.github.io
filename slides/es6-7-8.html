<!doctype html>
<link rel="stylesheet" href="reveal.js/css/reveal.css">
<link rel="stylesheet" href="reveal.js/css/theme/league.css">
<link rel="stylesheet" href="reveal.js/lib/css/zenburn.css">
<style>
  .em-yellow {
    color: #EAD53F;
  }
  .no-include {
    opacity: 1 !important;
    visibility: visible !important;
  }
  .no-include.current-fragment {
    opacity: .2 !important;
  }
  .double-list {
    width: 100%;
    text-align: center;
  }
  .double-list ul {
    display: inline-block;
    max-width: calc(50% - 60px);
    vertical-align: top;
  }
  .double-list ul:first-child {
    margin-right: 40px;
  }
  .chn {
    font-size: .8em !important;
    position: relative;
    top: -.1em;
  }
</style>

<div class="reveal">
  <div class="slides">
    <!-- ES6 -->

    <section>
      <section>
        <h1>ECMAScript <span class="em-yellow">2015</span> (<span class="em-yellow">ES6</span>)</h1>
        <h3>New feature Glance</h3>
      </section>
      <section class="es6" data-transition="slide-in fade-out">
        <h3>ES6 Feature List</h3>
        <div class="double-list">
          <ul>
            <li>Arrows</li>
            <li>Classes</li>
            <li>Enhanced object literals</li>
            <li>Template strings</li>
            <li>Destructuring</li>
            <li>Default + rest + spread</li>
            <li>Let + Const</li>
            <li>Iterators + For...of</li>
            <li>Generators</li>
            <li class="fragment no-include" data-fragment-index="0">Unicode</li>
          </ul><ul>
            <li class="fragment no-include" data-fragment-index="0">Modules &amp; module loaders</li>
            <li>Map + Set + WeakMap + WeakSet</li>
            <li>Proxy</li>
            <li>Symbols</li>
            <li class="fragment no-include" data-fragment-index="0">Subclassable built-ins</li>
            <li>Promises</li>
            <li class="fragment no-include" data-fragment-index="0">Math + Number + String + Array + Object APIs</li>
            <li class="fragment no-include" data-fragment-index="0">Binary and octal literals</li>
            <li>Reflect API</li>
            <li class="fragment no-include" data-fragment-index="0">Tail calls</li>
          </ul>
        </div>
      </section>
    </section>
    <section>
      <h2>Enhanced Object Literals <span class="chn">对象简写</span></h2>
      <pre><code class="javascript" data-trim>
        var prop;
        var handler;
        var obj = {

          // 关键字 __proto__ 指定原型对象
          __proto__: theProtoObj,

          // 与变量同名属性/方法的简略写法
          prop, // prop: prop
          handler, // handler: handler

          // 方法的简略写法
          toString() {
            // 关键字 super 引用父级对象
            return "d " + super.toString();
          },

          // 计算属性名 (Computed/Dynamic Property Names)
          [ 'prop_' + (() => 42)() ]: 42

        };
      </code></pre>
    </section>
    <section>
      <h2>Destructuring <span class="chn">解构</span></h2>
      <pre><code class="javascript" data-trim>
        // 数组匹配
        var [a, , b] = [1, 2, 3];

        // 对象匹配
        var {op: a, lhs: {op: b}, rhs: c} = getASTNode()
        // 当变量名与属性名相同时可以简写
        var {op, lhs, rhs} = getASTNode()

        // 用于函数参数
        function g({name: x}) {
          console.log(x);
        }
        g({name: 5})

        // 空匹配保险
        var [a] = []; // a === undefined
        // 还可以设定默认值
        var [a = 1] = []; // a === 1
      </code></pre>
    </section>
    <section>
      <section>
        <h2>Default + Rest + Spread</h2>
        <pre><code class="javascript" data-trim>
        // Default
        function f(x, y = 12) {
          // 未提供 y 参数（或提供值为 undefined）时以默认值12参与计算
          return x + y;
        }
        f(3) // 15

        // Rest
        function f(x, ...y) {
          // y 此时为一个数组
          return x * y.length;
        }
        f(3, "hello", true) // 6

        // Spread
        function f(x, y, z) {
          return x + y + z;
        }
        // 将数组元素分别传递为各个参数
        f(...[1, 2, 3]) // 6
      </code></pre>
      </section>
      <section>
        <h3>Object Rest/Spread Properties</h3>
        <h6>(Stage 2)</h6>
        <pre><code class="javascript" data-trim>
          var {x, ...rest} = {x: 1, y: 2, a: 3, b: 4};
          console.log(x) // 1
          console.log(rest) // {y: 2, a: 3, b: 4}

          // 对象合并
          var obj1 = {x: 1, y: 2};
          var obj2 = {a: 3, b: 4};
          console.log({...obj1, ...obj2}) // {x: 1, y: 2, a: 3, b: 4}

          // 对象复制
          var obj = {x: 1, y: 2, a: 3, b: 4};
          var {...objClone} = obj;
          console.log(objClone) // {x: 1, y: 2, a: 3, b: 4}
        </code></pre>
      </section>
    </section>
    <section>
      <h2>Arrow Function <span class="chn">箭头函数</span></h2>
      <pre><code class="javascript" data-trim>
        // 表达式函数体（自动返回该表达式的值）
        var odds = evens.map(v => v + 1);
        var nums = evens.map((v, i) => v + i);
        var pairs = evens.map(v => ({even: v, odd: v + 1}));

        // 语句函数体
        nums.forEach(v => {
          if (v % 5 === 0)
            fives.push(v);
        });

        // 字面层 (Lexical) this
        var bob = {
          _name: 'Bob',
          _friends: [],
          printFriends() {
            this._friends.forEach(f =>
              console.log(this._name + ' knows ' + f));
          }
        }
      </code></pre>
    </section>
    <section>
      <h2>Template Strings <span class="chn">模板字符串</span></h2>
      <pre><code class="javascript" data-trim>
        `In JavaScript '\n' is a line-feed.`

        // 多行文本
        `In JavaScript this is
         not legal.`

        // 插值
        var name = 'Bob', time = 'today';
        `Hello ${name}, how are you ${time}?`

        // 标签 (Tagged) 模板字符串
        function POST(strings, ...keys) { /* ... */ }
        POST`http://foo.org/bar?a=${a}&b=${b}
             Content-Type: application/json
             X-Credentials: ${credentials}
             {"foo": ${foo},
              "bar": ${bar}}`(myOnReadyStateChangeHandler);
      </code></pre>
    </section>
    <section>
      <h2>Class</h2>
      <pre><code class="javascript" data-trim>
        class SkinnedMesh extends THREE.Mesh {
          constructor(geometry, materials) {
            super(geometry, materials);

            this.idMatrix = SkinnedMesh.defaultMatrix();
            this.bones = [];
            this.boneMatrices = [];
            //...
          }
          update(camera) {
            //...
            super.update();
          }
          get boneCount() {
            return this.bones.length;
          }
          set matrixType(matrixType) {
            this.idMatrix = SkinnedMesh[matrixType]();
          }
          static defaultMatrix() {
            return new THREE.Matrix4();
          }
        }
      </code></pre>
    </section>
    <section>
      <h2>Let + Const</h2>
      <pre><code class="javascript" data-trim>
        function f() {
          {
            let x;
            {
              const x = "sneaky"; // 没问题，本块内有效
              x = "foo"; // 错误，x 被声明为 const
            }
            let x = "inner"; // 错误，同块中已被声明
          }
        }
      </code></pre>
      <p>/* No more <code>var</code> */</p>
    </section>
    <section>
      <h2>Map + Set + WeakMap + WeakSet</h2>
      <pre><code class="javascript" data-trim>
        // Set
        let s = new Set();
        s.add("hello").add("goodbye").add("hello");
        s.has("hello") // true
        console.log(s.size) // 2

        // Map
        let m = new Map();
        m.set("hello", 42);
        m.set(s, 34);
        m.get(s) // 34

        // WeakMap
        let wm = new WeakMap();
        wm.set(s, {extra: 42});
        console.log(wm.size) // undefined

        // WeakSet
        let ws = new WeakSet();
        ws.add({data: 42});
        // 由于添加的对象没有其他引用，该对象随时会被清除
      </code></pre>
    </section>
    <section>
      <section>
        <h2>Symbol</h2>
        <h6>(Babel: Partial Support)</h6>
        <pre><code class="javascript" data-trim>
          let sym1 = Symbol();
          let sym2 = Symbol('foo');
          let sym3 = Symbol('foo');
          console.log(sym2 == sym3) // false
          console.log(sym3.toString()) // Symbol(foo)

          // 全局 Symbol 注册表
          let sym4 = Symbol.for('foo');
          console.log(sym4 === Symbol.for('foo')) // true
          console.log(Symbol.keyFor(sym4)) // foo
        </code></pre>
      </section>
      <section>
        <h3>Private Emulation In Class <span class="chn">模拟私有成员</span></h3>
        <pre><code class="javascript" data-trim>
          let MyClass = (function() {
            let key = Symbol("key");

            function MyClass(privateData) {
              this[key] = privateData;
            }

            MyClass.prototype = {
              doStuff: function() {
                ... this[key] ...
              }
            };

            return MyClass;
          }());

          let c = new MyClass("hello")
          console.log(c["key"]) // undefined
        </code></pre>
      </section>
    </section>
    <section>
      <h2>Iterator + For...Of</h2>
      <pre><code class="javascript" data-trim>
        let fibonacci = {
          [Symbol.iterator]() {
            let pre = 0, cur = 1;
            return {
              next() {
                [pre, cur] = [cur, pre + cur];
                return { done: false, value: cur }
              }
            }
          }
        }

        for (let n of fibonacci) {
          if (n > 1000) // 设定上限
            break;
          console.log(n);
        }
      </code></pre>
    </section>
    <section>
      <h2>Promise</h2>
      <pre><code class="javascript" data-trim>
        function timeout(duration = 0) {
          return new Promise((resolve, reject) => {
            setTimeout(resolve, duration);
          });
        }

        let p = timeout(1000).then(() => {
          return timeout(2000);
        }).then(() => {
          throw new Error("hmm");
        }).catch(err => {
          return Promise.all([timeout(100), timeout(200)]);
        });
      </code></pre>
    </section>
    <section>
      <h2>Generators <span class="chn">生成器</span></h2>
      <pre><code class="javascript" data-trim>
        var fibonacci = {
          [Symbol.iterator]: function*() {
            let pre = 0, cur = 1;
            for (;;) {
              let temp = pre;
              pre = cur;
              cur += temp;
              yield cur;
            }
          }
        }

        for (let n of fibonacci) {
          if (n > 1000) // 设定上限
            break;
          console.log(n);
        }
      </code></pre>
    </section>
    <section>
      <h2>Proxy</h2>
      <h6>(Babel: No Support)</h6>
      <pre><code class="javascript" data-trim>
        // 代理一个对象
        let target = {};
        let handler = {
          get: function (receiver, name) {
            return `Hello, ${name}!`;
          }
        };

        let p = new Proxy(target, handler);
        console.log(p.world) // 'Hello, world!'

        // 代理一个函数
        let target = function () { return 'I am the target'; };
        let handler = {
          apply: function (receiver, ...args) {
            return 'I am the proxy';
          }
        };

        let p = new Proxy(target, handler);
        p() // 'I am the proxy'
      </code></pre>
    </section>
    <section data-transition="slide-in fade-out">
      <h2>Reflect API</h2>
      <pre><code class="javascript" data-trim>
        // No example
      </code></pre>
    </section>

    <!-- ES7 -->

    <section>
      <section data-transition="fade" data-background-color="#000" data-autoslide="1000"></section>
      <section data-transition="fade-in slide-out">
        <h1>ECMAScript <span class="em-yellow">2016</span> (<span class="em-yellow">ES7</span>)</h1>
        <h3>New feature Glance</h3>
      </section>
      <section>
        <h3>ES7 Feature List</h3>
        <ul>
          <li>Array.prototype.includes()</li>
          <li>Exponentiation Operator</li>
        </ul>
      </section>
    </section>
    <section>
      <h2>Array.prototype.includes()</h2>
      <pre><code class="javascript" data-trim>
        ['a', 'b', 'c'].includes('a') // true
        ['a', 'b', 'c'].includes('d') // false

        // 通常情况下这两个表达式相同
        arr.includes(x)
        arr.indexOf(x) >= 0

        // 但 includes() 可以正确处理 NaN
        [NaN].includes(NaN) // true
        [NaN].indexOf(NaN) // -1
      </code></pre>
    </section>
    <section data-transition="slide-in fade-out">
      <h2>Exponentiation Operator <span class="chn">指数操作符</span></h2>
      <pre><code class="javascript" data-trim>
        // 以下两句相同
        x ** y
        Math.pow(x, y)

        let squared = 3 ** 2;
        console.log(squared) // 9

        let num = 3;
        num **= 2;
        console.log(num) // 9
      </code></pre>
    </section>

    <!-- ES8 -->

    <section>
      <section data-transition="fade" data-background-color="#000" data-autoslide="1000"></section>
      <section data-transition="fade-in slide-out">
        <h1>ECMAScript <span class="em-yellow">2017</span> (<span class="em-yellow">ES8</span>)</h1>
        <h3>New Feature Glance</h3>
      </section>
      <section>
        <h3>ES8 Feature List</h3>
        <ul>
          <li>Trailing commas in function parameter lists and calls</li>
          <li>Object.values() &amp; Object.entries()</li>
          <li>Object.getOwnPropertyDescriptors()</li>
          <li>String padding</li>
          <li>Async Functions <span class="fragment em-yellow">(Finally!)</span></li>
        </ul>
      </section>
    </section>
    <section>
      <section>
        <h2>Trailing Commas <span class="chn">尾逗号</span></h2>
        <pre><code class="javascript" data-trim>
          // 数组字面量的尾逗号会被忽略
          [1, 2, 3,]

          // ES5 开始对象字面量的尾逗号也会被忽略了
          {a: 1, b: 2, c: 3,}

          // 现在轮到了函数参数列
          function foo(para1, para2,) {}
          foo(p1, p2,)
        </code></pre>
      </section>
      <section data-transition="slide-in fade-out">
        <h3>Why this?</h3>
        <p>以前当你做出这样的修改后……</p>
        <pre><code class="javascript" data-trim>
          /* before */        /* after */
          1 | [               1 | [
          2 |   'one',        2 |   'one',
          3 |   'two'         3 |   'two',
          4 | ]               4 |   'three'
                              5 | ]
        </code></pre>
        <p class="fragment" data-fragment-index="0">……你会得到这样的 diff 日志</p>
        <pre class="fragment" data-fragment-index="0"><code class="javascript" data-trim>
          -3 |   'two'  // 这两行其实
          +3 |   'two', // 毫无意义
          +4 |   'three'
        </code></pre>
      </section>
    </section>
    <section>
      <h2>Object.values() & Object.entries()</h2>
      <pre><code class="javascript" data-trim>
        // Object.values()
        let obj1 = {a: 'foo', b: 42};
        console.log(Object.values(obj1)) // ['foo', 42]

        // 忽略非自有、不可枚举属性
        let obj2 = Object.create({a: 'foo'}, {b: {value: 'bar'}});
        obj2.c = 42;
        console.log(Object.values(obj2)) // [42]

        // Object.entries()
        console.log(Object.entries(obj1)) // [['a', 'foo'], ['b', 42]]
        console.log(Object.entries(obj2)) // [['c', 42]]
      </code></pre>
    </section>
    <section>
      <h2>String Padding <span class="chn">字符串补丁</span></h2>
      <pre><code class="javascript" data-trim>
        'x'.padStart(5, 'ab') // 'ababx'
        'x'.padStart(4, 'ab') // 'abax'
        'abcd'.padStart(2, '#') // 'abcd'
        'abc'.padStart(10, '0123456789') // '0123456abc'
        'x'.padStart(3) // '  x'

        'x'.padEnd(5, 'ab') // 'xabab'
        'x'.padEnd(4, 'ab') // 'xaba'
        'abcd'.padEnd(2, '#') // 'abcd'
        'abc'.padEnd(10, '0123456789') // 'abc0123456'
        'x'.padEnd(3) // 'x  '
      </code></pre>
    </section>
    <section>
      <section>
        <h2>Async Functions <span class="chn">异步函数</span></h2>
        <pre><code class="javascript" data-trim>
          async function () {
            await ...
          }
        </code></pre>
      </section>
      <section>
        <h3>Promise</h3>
        <pre><code class="javascript" data-trim>
          function addUser(username, age) {
            return new Promise((resolve, reject) => {
              // 检查用户名，成功则调用 resolve，失败则调用 reject
              // 异步返回用户编号: resolve(userid)
              checkUsername(username, resolve, reject);
            }).then(userid => {
              // 显示 Loading 动画
              spinning(`Your ID is ${userid}`);
              // 添加用户信息，成功则调用 resolve，失败则调用 reject
              return new Promise((resolve, reject) => {
                addUserInfo(username, age, resolve, reject);
              });
            }).then(() => {
              alert('Your account has been created successfully');
              location.reload();
            }).catch(err => {
              alert(err);
            });
          }
        </code></pre>
      </section>
      <section>
        <h3>async</h3>
        <pre><code class="javascript" data-trim>
          async function addUser(username, age) {
            try {
              // 检查用户名
              let userid = await checkUsername(username);
              // 显示 Loading 动画
              spinning(`Your ID is ${userid}`);
              // 添加用户信息
              await addUserInfo(username, age);
              alert('Your account has been created successfully');
              location.reload();
            } catch (err) {
              alert(err);
            }
          }
        </code></pre>
      </section>
    </section>

    <!-- End -->

    <section>
      <section data-transition="fade" data-background-color="#000" data-autoslide="1000"></section>
      <section data-transition="fade">
        <h1>Q&A</h1>
        <h6>and</h6>
        <h1>Thanks</h1>
      </section>
    </section>
  </div>
</div>

<script src="reveal.js/lib/js/head.min.js"></script>
<script src="reveal.js/js/reveal.js"></script>
<script>
  Reveal.initialize({
    width: '100%',
    height: '100%',
//    controls: false,
    dependencies: [
      { src: 'reveal.js/plugin/markdown/marked.js' },
      { src: 'reveal.js/plugin/markdown/markdown.js' },
      { src: 'reveal.js/plugin/highlight/highlight.js', async: true, callback: function () { hljs.initHighlightingOnLoad(); } },
    ],
  });
</script>